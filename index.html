<!DOCTYPE html>
<html>
<head>
    <title>Ai upscaler</title>
    <link rel='stylesheet' href="css/app.css">
    <link rel="icon" href="icon.png">
    <!-- افزودن کتابخانه Gradio Client -->
    <script src="https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js"></script>
</head>

<body class="container is-max-desktop has-background-light is-mobile has-text-black-bis">

<!-- بخش هدر (بدون تغییر) -->
<section class="container has-background-white-ter is-mobile">
  <div class="hero-body has-background-grey-lighter">
    <div class="container">
      <div class="columns is-flex">
        <div class="column">
          <h1 class="title" style="margin-left: 150px; margin-top: 50px;"> 
            <a class="has-text-black-bis" href="#"> Ai Upscaler </a> 
          </h1>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- بخش اصلی با دو کادر -->
<section class="box m-5 has-background-white has-text-black-bis">
  <div class="container is-fluid">
    <div class="columns">
      
      <!-- کادر آپلود -->
      <div class="column">
        <div onclick="triggerUpload('imageUpload1')" 
             style="cursor: pointer; border: 2px dashed #ccc; padding: 20px; text-align: center;">
          <img id="previewImage1" src="" alt="Preview" style="max-width: 100%; display: none;">
          <p id="placeholder1">برای بارگذاری تصویر کلیک کنید</p>
        </div>
        <input type="file" id="imageUpload1" accept="image/*" 
               style="display: none;" 
               onchange="loadImage(event, 'previewImage1', 'placeholder1')">
        <br>
        <button onclick="removeImage('previewImage1', 'placeholder1')" 
                class="button is-danger">حذف تصویر</button>
        <button onclick="processImage()" 
                class="button is-primary">پردازش تصویر</button>
      </div>

      <!-- کادر نتیجه -->
      <div class="column">
        <div style="border: 2px dashed #ccc; padding: 20px; text-align: center;">
          <img id="previewImage2" src="" 
               alt="تصویر پردازش شده" 
               style="max-width: 100%; display: none;">
          <div id="loading" style="display: none;">
            <p>در حال پردازش...</p>
            <progress class="progress is-small is-primary" max="100"></progress>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- فوتتر (بدون تغییر) -->
<footer class="section has-background-dark is-mobile">
  <!-- ... -->
</footer>

<script>
// توابع مدیریت تصویر
function triggerUpload(inputId) {
    document.getElementById(inputId).click();
}

function loadImage(event, imageId, placeholderId) {
    const output = document.getElementById(imageId);
    const file = event.target.files[0];
    
    if (file) {
        output.src = URL.createObjectURL(file);
        output.style.display = 'block';
        document.getElementById(placeholderId).style.display = 'none';
    }
}

function removeImage(imageId, placeholderId) {
    const output = document.getElementById(imageId);
    output.src = "";
    output.style.display = 'none';
    document.getElementById(placeholderId).style.display = 'block';
    document.getElementById('previewImage2').style.display = 'none';
}

async function processImage() {
    var srcImage = document.getElementById('imageUpload1').dataset.imageUrl;

    if (!file) {
        alert("لطفاً تصویری را بارگذاری کنید.");
        return;
    }

    const response = await fetch(srcImage);
    const imageBlob = await response.blob();

    const client = await Client.connect("TheStinger/Ilaria_Upscaler");
    const result = await client.predict("/realesrgan", { 
        img: imageBlob,         
        model_name: "RealESRGAN_x4plus",        
        denoise_strength: 0,        
        face_enhance: true,         
        outscale: 1, 
    });

    const outputImage = result.data;
    document.getElementById('previewImage1').src = outputImage;
    document.getElementById('previewImage1').style.display = 'block';
}

</script>

</body>
</html>
